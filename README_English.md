FOFA Data Downloader Bot

**Your personal FOFA asset search engine and analysis assistant.**

This powerful Telegram bot is deeply integrated with the [FOFA](https://fofa.info) API, allowing you to search, download, analyze, and manage cyberspace assets directly through Telegram. It's more than just a data extraction tool; it's a one-stop platform integrating diverse post-processing and analysis capabilities.

## Disclaimer

* Any scripts, logos, and workflows included in this project are for resource sharing and learning purposes only. Their legality, legitimacy, and accuracy are not guaranteed. Please exercise discretion and refrain from using the project for any commercial or profit-making purposes.

* Following the safe harbor principle, if any images or content infringes upon copyright, please report them in the Issues section and they will be removed after verification. All copyright belongs to the original author and their website.

* I assume no responsibility for any content, including but not limited to any losses or damages caused by any errors in the content.

* Anyone accessing this website or directly or indirectly using project-related resources through any means should carefully read this disclaimer. Use or reprint any tutorials or resources related to this project constitutes acceptance of this disclaimer.

* Any reproduction or publication of any resource files in this project by any public account or self-media outlet is prohibited.

* The data used in this project is independently generated by the individuals or organizations using it. This project is not responsible for the data content, including but not limited to its authenticity, accuracy, and legality. All consequences arising from the use of this project are not the responsibility of any of its contributors and are the sole responsibility of the individuals or organizations using it.

* The third-party hardware and software used in this project have no direct or indirect relationship with this project. This project only provides an objective description of the deployment and usage process and does not endorse the use of any third-party hardware or software. All consequences arising from the use of any third-party hardware or software are the sole responsibility of the individuals or organizations using it and are not the responsibility of this project.

* All content in this project is for learning and research purposes only. Any use of this project for illegal activities, including but not limited to establishing a VPS or other purposes that violate national, regional, or organizational laws, regulations, or other relevant provisions, is prohibited. The author is not responsible for any privacy breaches or other consequences resulting from this use.

* Any modifications based on the source code of this project are the voluntary actions of other individuals or organizations and are not directly or indirectly related to this project. Any consequences resulting from such modifications are not the responsibility of this project.

* This project reserves the right to supplement or modify this disclaimer at any time. Individuals or organizations that directly or indirectly use this project's content are deemed to have accepted this project's special disclaimer.

## ‚ú® Core Features

* **üöÄ Advanced Asset Search**:
* **Precise Search**: Use the `/kkfofa` command to execute any FOFA syntax query.
* **Presets and Filters**: Administrators can preset commonly used queries and quickly add region (continent) filters during execution.
* **Multiple Download Modes**:
* **Full Download**: Quickly download results up to 10,000 records.
* **Deep Traceback**: Go back through time to break the 10,000 record limit and theoretically obtain the full data set.
* **Incremental Update**: Update cached query results and only download newly added data, saving F points.

* **üìä Deep Data Analysis**:
* **Host Profile (`/host`)**: Obtain comprehensive information for a single IP or domain, including open ports, services, certificates, banners, and more.
* **Aggregated Statistics (`/stats`)**: Analyzes global aggregated statistics for any query, providing quick insights into the macro-distribution of assets (e.g., top countries, services, ports, etc.).
* **Batch Feature Analysis (`/batchfind`)**: Upload a list of IP addresses (in `ip:port` format), and the robot will automatically search and intelligently analyze the common features of these assets, automatically generating suggested FOFA queries**, making it a powerful tool for threat intelligence analysis and asset classification.

* **üõ†Ô∏è Powerful Post-Processing Tools**:
* **Liveliness Check**: After downloading, perform a port liveness check on the results with one click.
* **Subnet Scan**: Scans the same ports as the IP addresses in the C segment of the results to discover more potential assets.

* **‚öôÔ∏è Convenient Management Features**:
* **Interactive Settings (`/settings`)**: Easily manage API keys, HTTP proxies, query presets, and more through the menu. * **Multiple API Key Support**: You can add multiple FOFA API keys and specify them for use during queries. The robot will automatically switch to another key if a key expires or if the number of F-points is insufficient.
* **Data Management**: Supports configuration backup and restoration, query history review, and importing existing data files, all linked to FOFA syntax.
* **Online Update (`/update`)**: You can configure the update source URL to update the robot script online with one click and automatically restart it.

## üìñ Preparation

Before you begin, you will need the following three things:

1. **A Server**: A Linux server (or any Python-enabled PC/Mac) that can run Python scripts 24/7. It is best not to use this in China or other regions where Telegram is blocked (such as Iran) (due to the Great Firewall, a proxy will be required).
2. **FOFA API Key**:
* You must have a [FOFA](https://fofa.info) Individual Membership or higher account. (Or, don't become a member and top up more F-points.)
* After logging in, find your Key in "Personal Center" -> "API Interface."
3. **Telegram Bot Token**:
* Search for `@BotFather` in Telegram and start a conversation.
* Send the `/newbot` command.
* Follow the prompts to set a name and username for your bot (must end with `bot`).
* `BotFather` will give you a long string of characters, which is your **Bot Token**. Please keep it safe and don't disclose it.

## üöÄ Deployment Guide

Even if you're a beginner, simply follow the steps below to easily deploy successfully.

## Step 1: Download the Script

Download the latest version of the Python script ( `fofa.py`) provided with this project to your server.
```bash
wget https://raw.githubusercontent.com/CXK-Computer/fofa_bot/refs/heads/main/fofa.py
```
You can also download requirements.txt to your server.
```bash
wget https://raw.githubusercontent.com/CXK-Computer/fofa_bot/refs/heads/main/requirements.txt
```
You can also download pre-compiled binaries directly from the distribution.

### Step 2: Install Dependencies

The bot relies on several Python libraries. Open the server terminal and run the following commands to install them:

```bash
pip3 install python-telegram-bot==13.15 requests "urllib3<2.0"
```
Or (if you've already downloaded requirements.txt)
```bash
pip3 install -r requirements.txt
```
*Note: We specify version 13.15 of `python-telegram-bot` to ensure compatibility.*

### Step 3: Configure the bot

1. Create a file named `config.json` in the same directory as the script.
2. Copy and paste the following into the `config.json` file:

```json
{
"bot_token": "Paste your Telegram Bot Token here",
"apis": [
"Paste your first FOFA API Key here"
],
"admins": [],
"proxy": "",
"full_mode": false,
"public_mode": false,
"presets": [],
"update_url": ""
}
```

3. **Modify the configuration file**:
* `"bot_token"`: Replace with the token you obtained from `@BotFather` in the **Preparation**.
* `"apis"`: Replace with your FOFA API Key. You can add multiple keys separated by commas, for example: `["key1", "key2"]`.
* `"admins"`: **Leave this field empty**. When you first start the bot by sending it the `/start` command, it will automatically add your Telegram user ID as the first administrator.
* `"proxy"`: If your server requires a proxy to access Telegram (e.g., in China, Iran, etc.), enter the proxy address here, for example, `"http://127.0.0.1:7890"`. If not, leave it blank.

### Step 4: Run the bot

In the terminal, start the bot using the following command:

```bash
python3 fofa.py
```

If everything went well, you should see a log message similar to "üöÄ Ultimate bot started..." Now you can find your bot in Telegram and start using it!

### Step 5: Keep the bot running in the background (recommended)

To keep the bot running even after you close the terminal, we recommend using `nohup`:

```bash
nohup python3 -u fofa.py > fofa_bot_run.log 2>&1 &
```
You can also use `screen`:
```bash
screen -S fofa
python3 fofa.py
```

The above command will cause the bot to run in the background and output all logs to the `fofa_bot_run.log` file (screen will not work).

## üìö Command Details

Below is a detailed description of all available commands.

---

### üîç Asset Query

* **/kkfofa `[key_index] <query>`**
* **Function**: Core FOFA query commands.
* **Usage**:
* Without parameters (`/kkfofa`): If a preset query is set, a preset query menu will pop up.
* With parameters (`/kkfofa domain="example.com"`): Execute the query directly.
* With a specified key (`/kkfofa 2 app="nginx"`): Query using the second API key configured in `config.json`.
* **Interaction Flow**:
1. After executing the query, the bot will ask whether to filter by continent.
2. Next, it will check if there is a local cache.
3. If there are more than 10,000 results, it will prompt you to select a download mode (full/deep).

---

### üìä Data Analysis

* **/host `<ip|domain>`**
* **Function**: Get detailed information for a single target.
* **Example**: `/host 1.1.1.1` or `/host example.com`
* **Output**: If there is too much information, a summary will be sent, and a detailed report with the complete banner/header will be sent as a file.

* **/stats `<query>`**
* **Function**: Aggregate statistics for a FOFA query.
* **Example**: `/stats app="Apache-Tomcat"`
* **Output**: Returns the top 5 statistics for countries, organizations, services, ports, etc.

* **/batchfind**
* **Function**: Batch analyze common asset characteristics. This is the machine
One of the core features of the bot.

* **Usage**:
1. Send the `/batchfind` command.
2. Upload a `.txt` file with one `ip:port` per line (compatibility with various complex formats, such as `1.1.1.1:443 | ...`).
3. Select the analysis dimension of interest (such as service, certificate, title, etc.) from the menu.
4. The bot will batch-query these assets and generate a report containing the top features and recommended FOFA query statements.

---

### ‚öôÔ∏è Management and Settings

* **/settings**
* **Function**: Access the interactive settings menu to manage:
* **API Management**: View, add, and delete FOFA API keys, and switch query modes (recent year/full history).
* **Preset Management**: Add or delete frequently used query statements as presets for quick access.
* **Proxy Settings**: Set or clear the HTTP proxy.
* **Backup & Restore**: Quickly back up your configuration file.
* **Script Update**: Set the update source URL.

* **/history**
* **Function**: View the last 10 query history records and their cache status.

* **/import**
* **Function**: Associate an existing result file (.txt) with a FOFA query statement and cache it.
* **Usage**: In Telegram, **reply** with the `.txt` file you want to import, then enter the `/import` command. The bot will prompt you to enter the associated query statement.

* **/backup** & **/restore**
* **Function**: Back up or restore your `config.json` configuration file.
* **Usage**: `/backup` will send the file directly to you. `/restore` will prompt you to upload the configuration file.

---

### üíª System Management

* **/update**
* **Function**: If `update_url` is configured in the settings, this command will download the latest script from that URL and automatically restart the bot.

* **/getlog**
* **Function**: Get the bot's running log file `fofa_bot.log`.

* **/shutdown**
* **Function**: Safely shut down the bot process.

* **/stop**
* **Function**: Emergency stop of ongoing data download tasks (such as deep traceback).

* **/cancel**
* **Function**: Cancel ongoing session operations (such as settings, imports, etc.).

## ‚ùì FAQ

1. **What should I do if the bot is unresponsive? **
* Check that the `bot_token` in `config.json` is correct.
* Check that the server network is normal and that the Telegram API can be accessed (if not, please set up a proxy. It will definitely not work in China without a proxy).
* Check the `fofa_bot_run.log` log file for any errors (please submit an update if any).

2. **Why does the bot say I don't have permission when I send a command?**
* After the bot starts, the first user who sends `/start` to it is automatically set as an administrator. Please ensure that your Telegram user ID has been correctly added to the `admins` list in `config.json`.

3. **Why did the FOFA query fail?**
* **Invalid API Key**: Check if the key is correct or has expired.
* **Insufficient F-Points**: Log in to the FOFA official website to check your F-Point balance.
* **Syntax Error**: Check if your FOFA query syntax is correct.

## üìû Support & Feedback

- üêõ **Bug Reports**: [GitHub Issues](https://github.com/CXK-Computer/fofa_bot/issues)
- üí° **Feature Suggestions**: [GitHub Discussions](https://github.com/CXK-Computer/fofa_bot/discussions) ## üìû Support & Feedback

## ü§ù Contribution Guidelines

Issues and pull requests are welcome!

1. Fork this repository
2. Create a feature branch: `git checkout -b feature/amazing-feature`
3. Commit changes: `git commit -m 'Add amazing feature'`
4. Push the branch: `git push origin feature/amazing-feature`
5. Submit a pull request

## ‚≠ê Star
[![Stargazers over time](https://starchart.cc/CXK-Computer/fofa_bot.svg?variant=adaptive)](https://starchart.cc/CXK-Computer/fofa_bot)## Stargazers over time

## üôè Credits

[X-Fofa](https://github.com/sv3nbeast/X-Fofa) for providing deep traceability implementation

`Github Community`
